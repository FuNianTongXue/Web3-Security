# 研发安全管理平台审计报告

## 报告主字段

- 项目id: `gitlab_1001`
- 项目名称: contract-risk-lab
- 项目简称: contract-risk-lab
- 所属部门: sec-team
- 所属团队: sec-team
- 项目责任人: sec-owner
- 项目负责人: sec-owner
- 安全责任人: sec-lead
- 测试责任人: 未设置
- git分支id: main
- 备注: 

- 扫描路径: `.cache/repos/sec-team_contract-risk-lab`
- 发现总数: **0** (P0=0, P1=0, P2=0)

## 自动化命中

未命中规则。

## 漏洞报告明细（主字段）

无漏洞条目。

## Checklist（需人工复核）

- [P0] CHK-001 资产守恒不变量（池余额/总份额/总债务/储备金）
  - 修复建议: 引入 invariant 测试；统一更新顺序；监控差值告警
- [P0] CHK-002 存款份额 mint/redeem 舍入
  - 修复建议: 最小初始流动性；最小存款门槛；高精度缩放
- [P1] CHK-003 借款/还款计息舍入
  - 修复建议: 统一精度；利息累积用 index；舍入方向固定
- [P0] CHK-004 跨资产 decimals/priceDecimals 对齐
  - 修复建议: 统一内部 1e18 精度；显式转换函数
- [P0] CHK-005 fee-on-transfer 代币兼容（到账≠转出）
  - 修复建议: 用余额差值记账；或禁用此类资产
- [P1] CHK-006 rebasing 代币兼容
  - 修复建议: 隔离池；更保守抵押率；专门适配
- [P1] CHK-007 强制转账（ETH selfdestruct / ERC20 直转）
  - 修复建议: 提供 sweep/救援函数；关键计算用内部现金变量
- [P0] CHK-008 救援函数 sweepToken 风险
  - 修复建议: 强制禁止扫底层资产；白名单；多签+timelock
- [P0] CHK-009 管理员角色最小化（分权）
  - 修复建议: 分离角色：Pause/Param/Upgrade；多签+timelock
- [P1] CHK-010 紧急暂停 pause 设计
  - 修复建议: 关键入口可暂停；恢复更严格（unpause timelock）
- [P1] CHK-011 unpause 恢复门槛
  - 修复建议: 恢复走 timelock；两阶段恢复（先限额后全开）
- [P0] CHK-012 升级代理 initializer 可重复
  - 修复建议: 使用 OZ Initializable；部署后立即初始化并锁死
- [P0] CHK-013 升级存储布局冲突
  - 修复建议: 固定存储槽；升级脚本校验；强制回归测试
- [P0] CHK-014 时间锁绕过通道
  - 修复建议: 统一走 timelock；紧急通道需多签+公开告警
- [P0] CHK-015 治理投票借票（闪电贷投票）
  - 修复建议: 使用快照（snapshot）/锁仓投票；提案延迟执行
- [P1] CHK-016 参数变更幅度限制
  - 修复建议: 设置硬上限/下限；分阶段调整；变更需公告期
- [P0] CHK-017 单点预言机（单 DEX 即时价）
  - 修复建议: 多源聚合；TWAP；偏离阈值熔断
- [P1] CHK-018 TWAP 窗口过短
  - 修复建议: 延长窗口；多源校验；异常波动暂停
- [P0] CHK-019 价格过期（stale）
  - 修复建议: 设置 maxDelay；过期禁用借贷/清算或降级
- [P1] CHK-020 价格异常跳变保护
  - 修复建议: 偏离阈值触发暂停或提高保证金
- [P0] CHK-021 价格单位/精度转换错误
  - 修复建议: 统一内部精度；显式转换库函数
- [P1] CHK-022 抵押品流动性/可清算性评估缺失
  - 修复建议: 对低流动性资产更保守参数；隔离池
- [P0] CHK-023 健康度计算覆盖完整资产与债务
  - 修复建议: 统一会计口径；复用公共计算函数
- [P1] CHK-024 部分清算规则正确
  - 修复建议: 按比例处理坏账；限制最小清算比例
- [P0] CHK-025 清算奖励上限（剩余抵押不足）
  - 修复建议: 奖励 capped 到可用抵押；允许扣到0
- [P0] CHK-026 清算函数可用性（Gas DoS）
  - 修复建议: 分页处理；限制资产种类/仓位数
- [P0] CHK-027 清算过程外部调用重入
  - 修复建议: CEI 模式；ReentrancyGuard；pull 模式
- [P1] CHK-028 清算抢跑/自救干扰
  - 修复建议: 进入可清算状态限制某些操作；冷却期
- [P1] CHK-029 不可清算资产处理
  - 修复建议: 替代处置（拍卖/托管）；白名单资产
- [P1] CHK-030 利用率接近100%利率爆炸
  - 修复建议: 利率上限；平滑调整；借贷上限
- [P0] CHK-031 accrueInterest 覆盖所有入口
  - 修复建议: 入口统一先 accrue；集中化 modifier
- [P0] CHK-032 指数/利息变量精度与溢出
  - 修复建议: 采用成熟 index 模型；限制利率与时间步长
- [P1] CHK-033 储备金/坏账吸收机制
  - 修复建议: 保险基金；坏账拍卖；动态调整 reserveFactor
- [P0] CHK-034 同一交易内“操纵价格→借贷→清算”
  - 修复建议: 用 TWAP/多源；限额与速率限制；熔断
- [P1] CHK-035 跨协议抵押品上游风险
  - 修复建议: 隔离池；更保守抵押率；快速下架开关
- [P0] CHK-036 组合路径的状态机绕过
  - 修复建议: 限制敏感函数调用条件；不变量校验
- [P1] CHK-037 ERC20 transfer 返回值兼容
  - 修复建议: 统一 SafeERC20；失败回滚
- [P0] CHK-038 ERC777 回调重入
  - 修复建议: 重入锁；禁用该类资产或隔离
- [P1] CHK-039 approve 竞态（旧值被抢跑）
  - 修复建议: approve(0)再approve(new)或 increaseAllowance
- [P1] CHK-040 黑名单/冻结代币风险
  - 修复建议: 禁用/隔离；应急替代处置流程
- [P1] CHK-041 ETH 转账回退/DoS
  - 修复建议: 采用 pull；call 失败可重试/替代路径
- [P0] CHK-042 supply cap / borrow cap
  - 修复建议: 设置 cap；按流动性动态调整
- [P1] CHK-043 单账户限额/速率限制
  - 修复建议: 按资产/地址/时间窗限额；异常触发熔断
- [P0] CHK-044 关键指标监控（不变量/偏离/失败率）
  - 修复建议: 接入告警；自动暂停策略
- [P1] CHK-045 异常大额与新地址行为监控
  - 修复建议: 高风险行为要求延迟/更高保证金
- [P0] CHK-046 不变量测试（Foundry/Echidna）缺失
  - 修复建议: 把历史事故模式固化为性质测试
- [P1] CHK-047 回归测试库缺失
  - 修复建议: 每次修复新增用例；PR 必跑
- [P1] CHK-048 第三方库/合约升级风险
  - 修复建议: 固定依赖版本；准入评审；紧急开关
- [P1] DEX-DICT 价格预言机操纵（Spot/TWAP 仍可被操纵）
  - 修复建议: 独立预言机（如 Chainlink）+ TWAP；多源中位数；偏离熔断；流动性门槛与限额；分离估值与交易报价。
- [P1] DEX-DICT 通缩/手续费代币处理不当（Fee-on-transfer）
  - 修复建议: 用 balanceBefore/After 计算实际到账；对代币进行适配或白名单；关键路径做差分测试。
- [P1] DEX-DICT 路由器参数校验不足（Path/Recipient/Approve）
  - 修复建议: 严格校验接收者与路径；最小授权；对关键参数进行 allowlist；上线前做 fuzz/符号执行覆盖。
- [P1] DEX-DICT 重入与防护失效（含语言/库缺陷）
  - 修复建议: Checks-Effects-Interactions；独立 ReentrancyGuard；锁定安全编译器版本；紧急暂停与监控。
- [P1] DEX-DICT 不变量/边界条件错误（CLMM/StableSwap 等）
  - 修复建议: 形式化/属性测试；差分测试（多实现对照）；限额与灰度；对舍入/精度进行专门审计。
